<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <!-- ================== SETTING CONFIGURATION MENU ================ -->
        <menuitem action="act_dtbs_booking_settings" id="dtbs_booking_main" name="Booking Settings" parent="csmart_base.csmart_base" sequence="10"/>



        <menuitem id="booking_menu" name="Rental" parent="carrent.main_carrent_menu" sequence="200"/>
        <menuitem id="folio_menu" name="Folio" parent="carrent.main_carrent_menu" sequence="300"/>

        <!-- ============= BOOKING =================== -->
        <record model="ir.ui.view" id="dtbs_booking_tree_view">
            <field name="name">dtbs.booking.tree</field>
            <field name="model">dtbs.carrent.booking</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="dtbs_booking_tree" toolbar="1">
                    <field name="no_book"/>
                    <field name="customer_id"/>
                    <field name="date_rent"/>
                    <field name="unit_id"/>
                    <field name="police"/>
                    <field name="state"/>
                    <field name="warehouse_id"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="dtbs_booking_form_view">
            <field name="name">dtbs.booking.form</field>
            <field name="model">dtbs.carrent.booking</field>
            <field name="arch" type="xml">
                <form string="Booking">
                    <header>
                        <button name="confirm" type="workflow" string="Confirm" states="draft" class="oe_highlight"/>
                        <button name="rent" type="workflow" string="On Rent" states="confirm" class="oe_highlight"/>
                        <button name="cancel" type="workflow" string="Cancel" states="confirm"/>
                        <button name="return" type="workflow" string="Returned" states="rent" class="oe_highlight"/> 
                        <button name="action_confirm_send_mail_manual" string="Send by Email" type="object" class="oe_highlight" attrs="{'invisible':['|',('auto_mail','=',True),('state','!=','confirm')]}"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <label for="no_book" string="Booking Number"/>
                            <h1>
                                <field name="no_book" />
                            </h1>
                            <label for="customer_id" string="Customer"/>
                            <h3>
                                <field name="customer_id"/>
                            </h3>
                        </div>
                        <group>
                            <group>
                                <field name="partner_order_id" domain="[('parent_id','=',customer_id)]"/>
                                <field name="partner_invoice_id" domain="[('parent_id','=',customer_id)]" groups="sale.group_delivery_invoice_address" context="{'default_type':'invoice'}"/>
                            </group>
                            <group>
                                <field name="partner_shipping_id" domain="[('parent_id','=',customer_id)]" groups="sale.group_delivery_invoice_address" context="{'default_type':'delivery'}"/>
                                <field name="warehouse_id"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="date_order"/>
                            </group>
                            <group>
                                <field name="date_rent"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Rental Detail">
                                <group>
                                    <group>
                                        <field name="unit_id"/>
                                        <field name="police"/>
                                    </group>
                                    <group>
                                        <field name="pricelist" groups="product.group_uom"/>
                                        <field name="price" groups="product.group_uom"/>
                                        <field name="sale_uom" attrs="{'invisible':[('price_by_uom','=',True)]}"/>
                                        <field name="sale_price" attrs="{'invisible':[('price_by_uom','=',True)]}"/>
                                        <field name="price_by_uom" invisible="1"/>
                                        <field name="auto_mail" invisible="1"/>
                                        <field name="sale_price_currency_id"/>
                                        <field name="time_selection"/>
                                        <field name="estimation_time"/>
                                        <field name="date_end"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="dtbs_booking_search_view">
            <field name="name">dtbs.booking.search</field>
            <field name="model">dtbs.carrent.booking</field>
            <field name="arch" type="xml">
                <search>
                    <field name="no_book"/>
                    <field name="customer_id"/>
                    <field name="state"/>
                    <field name="date_order"/>
                    <field name="date_rent"/>
                    <field name="partner_order_id"/>
                    <field name="partner_invoice_id"/>
                    <field name="partner_shipping_id"/>
                    <field name="unit_id"/>
                    <field name="police"/>
                    <field name="pricelist" groups="product.group_uom"/>
                    <field name="price" groups="product.group_uom"/>
                    <field name="warehouse_id"/>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="dtbs_booking_list_action">
            <field name="name">Booking</field>
            <field name="res_model">dtbs.carrent.booking</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">Create new Booking here
                </p>
            </field>
        </record>

        <menuitem id="booking_rent_menu" name="Booking Rent" parent="booking_menu"
                  sequence="1"
                  action="dtbs_booking_list_action"/>


        <!-- ============ FOLIO ================ -->
        <record model="ir.ui.view" id="dtbs_carrent_folio_form_view">
            <field name="name">dtbs.carrent.folio.form</field>
            <field name="model">dtbs.carrent.folio</field>
            <field name="arch" type="xml">
                <form string="Folio">
                    <header>

                        <!-- <button name="ship_recreate" states="shipping_except" string="Recreate Delivery Order"/> -->
                        <!-- <button name="ship_corrected" states="shipping_except" string="Ignore Exception"/> -->
                        <button name="action_folio_send" string="Send by Email" type="object" states="draft" class="oe_highlight" groups="base.group_user"/>
                        <button name="action_folio_send" string="Send by Email" type="object" states="sent,progress,manual" groups="base.group_user"/>
                        <button name="print_folio" string="Print" type="object" states="draft" class="oe_highlight" groups="base.group_user"/>
                        <button name="print_folio" string="Print" type="object" states="sent,progress,manual" groups="base.group_user"/>
                        <button name="folio_action_button_confirm" states="draft" string="Confirm Sale" type="object" groups="base.group_user"/>
                        <button name="folio_action_button_confirm" states="sent" string="Confirm Sale" class="oe_highlight" type="object" groups="base.group_user"/>
                        <button name="action_view_invoice" string="View Invoice" type="object" class="oe_highlight"
                            attrs="{'invisible': [('invoice_exists', '=', False)]}" groups="base.group_user"/>
                        <field name="picking_ids" invisible="1"/>
                        <button name="folio_action_view_delivery" string="View Delivery Order" type="object" class="oe_highlight" attrs="{'invisible': ['|',('picking_ids','=',False),('picking_ids','=',[])]}" groups="base.group_user"/>
                        <button name="folio_action_invoice_create" string="Create Invoice" type="object" states="manual" class="oe_highlight" groups="base.group_user"/>
                        <!-- <button name="copy_quotation" states="cancel" string="New Copy of Quotation" type="object"/> -->
                        <button name="folio_cancel" states="draft,sent" string="Cancel Quotation" groups="base.group_user"/>
                        <button name="folio_action_cancel" states="manual,progress" string="Cancel Order" type="object" groups="base.group_user"/>
                        <!-- <button name="ship_cancel" states="shipping_except" string="Cancel Order"/> -->
                        <!-- <button name="invoice_cancel" states="invoice_except" string="Cancel Order" groups="base.group_user"/> -->

                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,progress,done" statusbar_colors='{"shipping_except":"red","invoice_except":"red","waiting_date":"blue"}'/>


                    </header>
                    <sheet>
                        <label string="Folio Number"/>
                        <h1>
                            <field name="name" colspan="4"/>
                        </h1>
                        <group colspan="4" col="4">
                            <field name="date_order"/>
                            <field name="warehouse_id" string="Branch"/>
                            <field name="invoiced"/>
                            <field name="invoice_exists" invisible="1"/>
                            <field name="rental_invoice_id" states='progress,done,cancel' readonly="1"/>
                        </group>
                        <notebook colspan="4">
                            <page string="Folio">
                                <group colspan="4" col="4">
                                    <field name="partner_id"  string="Customer Name" required="1" on_change="onchange_partner_id(partner_id, context)" domain="[('customer','=',True)]" context="{'search_default_customer':1, 'show_address': 1}" options='{"always_reload": True}'/>
                                    <field name="partner_invoice_id" groups="sale.group_delivery_invoice_address" context="{'default_type':'invoice'}"/>
                                    <field name="partner_shipping_id" groups="sale.group_delivery_invoice_address" context="{'default_type':'delivery'}" />
                                </group>
                                <newline/>

                                <separator string="Unit Lines" colspan="4"/>
                                <field name="unit_lines"  colspan="4" string="Unit Line"  nolabel="1">
                                    <form string="Unit Line">
                                        <notebook>
                                            <page string="Folio Line">
                                                <group>
                                                    <field name="booking_id" domain="[('customer_id','=',parent.partner_id),('state','=','confirm')]"/>
                                                    <separator string="Automatic Declaration" colspan="4"/>
                                                    <field name="product_id"/>
                                                    <field name="police"/>
                                                </group>
                                                <separator string="Manual Description" colspan="4" />
                                                <field name="name" colspan="4" select="2" placeholder="---Description---"/>
                                                <group>
                                                    <field name="product_uom_qty"/>
                                                    <field name="product_uom" string="Rent (UOM)"/>
                                                    <field name="price_unit" select="2" string="Price"/>
                                                    <field name="discount"/>
                                                    <newline/>
                                                    <field name="tax_id" colspan="4" nolabel="1"/>
                                                    <separator string="States" colspan="4"/>
                                                    <field name="state" select="2"/>
                                                    <field name="invoiced" select="2"/>
                                                </group>
                                            </page>
                                            <page string="Extra Info">
                                                <group>
                                                    <field name="product_uos_qty"/>
                                                    <field name="product_uos"  />
                                                    <field name="address_allotment_id" select="2"/>
                                                </group>
                                            </page>
                                            <page string="History">
                                                <separator string="Invoice Lines" colspan="4"/>
                                                <field name="invoice_lines" colspan="4" nolabel="1"/>
                                            </page>
                                        </notebook>
                                    </form>
                                    <tree string = "Unit Line">
                                        <field name="booking_id"/>
                                        <field name="product_id" string="Unit No"/>
                                        <field name="product_uom_qty" string="Qty"/>
                                        <field name="product_uom" string="Rent(UOM)"/>
                                        <field name="price_unit" string="Price"/>
                                        <field name="tax_id" widget="many2many_tags"/>
                                        <field name="price_subtotal"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                                
                            
                                <group colspan="2" class="oe_subtotal_footer oe_right">
                                    <field name="amount_untaxed" sum="Untaxed amount" widget='monetary' />
                                    <field name="amount_tax" widget='monetary'/>
                                    <div class="oe_subtotal_footer_separator oe_inline">
                                        <label for="amount_total" />
                                        <button name="button_dummy" string="Compute" states="draft" type="object" icon="terp-sale" class="oe_highlight"/>
                                    </div>
                                    <field name="amount_total" nolabel="1" sum="Total amount" widget='monetary'/>
                                </group>
                                <div class="oe_clear"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="dtbs_carrent_folio_tree_view">
            <field name="name">dtbs.carrent.folio.tree</field>
            <field name="model">dtbs.carrent.folio</field>
            <field name="arch" type="xml">
                <tree string="Folio" colors="blue:state == 'draft';gray:state == 'done'">
                    <field name="name"/>
                    <field name="partner_id"  select="1"/>
                    <field name="date_order" select="1"/>
                    <field name="state"/>
                    <field name="amount_total" sum="Total amount"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="dtbs_carrent_folio_search_view">
            <field name="name">dtbs.carrent.folio.search</field>
            <field name="model">dtbs.carrent.folio</field>
            <field name="arch" type="xml">
                <search string="Tables Detail">
                    <field name="partner_id" />
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="dtbs_folio_list_action">
            <field name="name">Folio</field>
            <field name="res_model">dtbs.carrent.folio</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="gen_folio_menu" name="Generate Folio" parent="folio_menu" 
                  sequence="101"
                  action="dtbs_folio_list_action"/>
    </data>
</openerp>